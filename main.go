/******************************************************************************
 * Author: liguoqiang
 * Date: 2023-09-06 17:50:11
 * LastEditors: liguoqiang
 * LastEditTime: 2024-07-11 17:38:01
 * Description:
********************************************************************************/

package main

import (
	"fmt"
	"hjyserver/api"
	"hjyserver/cfg"
	mylog "hjyserver/log"
	"hjyserver/mdb"
	"hjyserver/mdb/mysql"
	"hjyserver/mq"
	"hjyserver/redis"
)

func main() {
	err := cfg.InitConfig("./cfg/cfg.yml")
	if err != nil {
		fmt.Println("initialize config failed, ", err)
		return
	}
	mylog.Init()
	defer mylog.Close()
	if !mdb.Open() {
		mylog.Log.Error("connect database failed exit!")
		return
	}
	defer mdb.Close()
	// init mqtt object
	if !mq.InitMqtt() {
		mylog.Log.Error("init mqtt failed exit!")
		return
	}
	defer mq.CloseMqtt()
	// init redis object
	if !redis.InitRedis() {
		fmt.Println("init redis failed exit!")
		return
	}
	defer redis.CloseRedis()
	//启动web服务
	api.StartWeb()
}

func TestX1DayReport() {
	mysql.TestX1DayReport()
}

func TestHL77DayReport() {
	str := "{\n\t\"cmd\":\t106,\n\t\"sn\":\t20,\n\t\"ts\":\t1705718605,\n\t\"mac\":\t\"543204ab9372\",\n\t\"data\":\t\"{\\\"report_start\\\":1705716269,\\\"report_end\\\":1705717143,\\\"evaluation\\\":65,\\\"study_efficiency\\\":89,\\\"concentration\\\":59,\\\"flow_state\\\":[4,1705716269,2,1705716358,4,1705716838,2,1705717018,3,1705717055],\\\"seq_interval\\\":8,\\\"respiratory\\\":[13,14,14,15,15,16,16,16,16,16,16,16,16,16,16,15,14,14,13,13,13,13,12,12,12,13,13,14,14,14,14,15,15,15,15,15,16,16,15,15,15,14,14,14,14,14,14,13,13,13,13,12,13,14,15,15,16,16,17,17,17,17,18,18,18,18,18,17,17,17,18,18,17,17,17,17,17,16,16,15,15,15,15,15,15,15,15,14,14,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,16,16],\\\"heart_rate\\\":[70,71,73,74,76,77,78,79,80,80,80,80,81,80,80,79,77,76,74,73,71,70,68,67,67,66,66,67,67,68,69,71,72,73,73,73,72,72,71,70,69,69,68,68,68,67,67,67,67,68,68,68,68,68,68,68,69,70,70,70,71,71,73,74,76,77,79,79,79,80,80,80,80,80,81,81,82,82,82,81,79,78,78,77,76,75,75,75,74,73,72,72,73,73,72,72,72,72,71,71,71,71,71,71,71,71,71,71,71],\\\"posture_state\\\":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],\\\"activity_freq\\\":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,1,1,1,2,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],\\\"body_pos\\\":[88,67,67,71,77,72,71,70,87,60,66,70,67,62,63,76,73,62,75,66,62,63,58,80,86,54,71,64,68,68,55,60,65,73,80,72,59,58,66,65,68,78,76,77,61,65,65,73,65,62,64,61,73,87,62,72,69,73,63,66,64,64,73,73,67,67,63,58,58,60,59,63,65,61,63,63,61,59,61,62,67,72,55,61,64,65,65,59,59,66,67,59,72,67,107,105,20,0,0,0,0,0,0,0,0,0,0,0,0]}\"\n}"
	mysql.HandleLampMqttMsg([]byte(str))
}
